# MySQL InnoDBCluster ConfigMap 설정 가이드

## 1. 개요
MySQL Operator(Oracle)를 사용하여 배포된 InnoDBCluster에 사용자 정의 설정(my.cnf 등)을 적용하기 위해서는 Kubernetes ConfigMap을 사용해야 합니다. 직접 Pod 내부의 파일을 수정하는 것은 Pod 재시작 시 초기화되므로 권장하지 않습니다.

## 2. 구성 요소
1. **ConfigMap**: MySQL 설정 파일(my.cnf)의 내용을 담고 있는 Kubernetes 리소스입니다.
2. **InnoDBCluster YAML**: ConfigMap을 참조하도록 `spec.mycnf` 필드를 수정해야 합니다.

## 3. 적용 단계

### 단계 1: ConfigMap 정의 (mysql-configmap.yaml)
원하는 설정을 담은 `my.cnf` 파일을 ConfigMap으로 정의합니다.

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-custom-config
  namespace: default
data:
  my.cnf: |
    [mysqld]
    max_connections = 500
    character-set-server = utf8mb4
    collation-server = utf8mb4_unicode_ci
    # 필요한 추가 설정을 여기에 작성하세요.
```

### 단계 2: InnoDBCluster YAML 수정 (mysql-cluster.yaml)
`spec` 섹션 하위에 `mycnf` 항목을 추가하여 위에서 생성한 ConfigMap을 연결합니다.

**변경 전:**
```yaml
spec:
  secretName: secret
  instances: 3
  ...
```

**변경 후:**
```yaml
spec:
  secretName: secret
  instances: 3
  mycnf: # ConfigMap 참조 설정 추가
    name: mysql-custom-config # 위에서 만든 ConfigMap 이름
  ...
```

### 단계 3: 적용
kubectl 명령어를 통해 변경 사항을 클러스터에 반영합니다.

```bash
kubectl apply -f mysql-configmap.yaml
kubectl apply -f mysql-cluster.yaml
```

## 4. 주의 사항 및 문제 해결 (Troubleshooting)
- **Init 상태 지속**: `mysql-cluster-1`, `2`가 `Init` 상태에서 멈춰있는 경우, 주로 첫 번째 노드(`mysql-cluster-0`)와의 통신 문제나 클러스터 조인 과정에서의 설정 불일치가 원인일 수 있습니다. ConfigMap 적용 후 클러스터가 재시작되면서 이 문제가 해결될 수도 있으나, 여전히 문제가 지속된다면 `kubectl logs mysql-cluster-1 -c initmysql` 등을 통해 초기화 컨테이너의 로그를 확인해야 합니다.
- **설정 문법 오류**: `my.cnf` 내용에 문법 오류가 있으면 MySQL이 시작되지 않고 CrashLoopBackOff 상태가 될 수 있습니다.

## 5. 결론
ConfigMap을 사용하면 재배포 없이도 설정을 유연하게 관리할 수 있으며, 모든 노드에 일관된 설정을 적용할 수 있습니다.
